<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quizlet Supabase</title>
<style>
body { font-family: Arial; background: linear-gradient(135deg, #a18cd1, #fbc2eb, #8fd3f4); text-align:center; margin:0; padding:0; }
.hidden { display:none; }
input { margin:5px; padding:8px; width:80%; border-radius:5px; border:1px solid #ccc; }
button { padding:8px 12px; margin:5px; border:none; border-radius:5px; cursor:pointer; background:#a18cd1; color:white; }
button:hover { background:#875fb3; }
.card-editor input { width: 90%; margin-bottom: 5px; }
.card-editor { margin:10px 0; background:#fff; padding:10px; border-radius:10px; }
.card-container { perspective:1000px; margin:20px auto; width:90%; max-width:400px; height:200px; }
.card { width:100%; height:100%; position:relative; transform-style: preserve-3d; transition: transform 0.6s; cursor:pointer; }
.card.flipped { transform: rotateY(180deg); }
.card-face { position:absolute; width:100%; height:100%; border-radius:15px; display:flex; align-items:center; justify-content:center; backface-visibility:hidden; font-weight:bold; font-size:20px; }
.card-back { background:#f0f0f0; transform:rotateY(180deg); }
</style>
</head>
<body>

<!-- Auth -->
<div id="auth-screen">
  <h2>Connexion / Inscription</h2>
  <input type="email" id="email" placeholder="Email"><br>
  <input type="password" id="password" placeholder="Mot de passe"><br>
  <button onclick="login()">Connexion</button>
  <button onclick="signup()">Inscription</button>
  <p id="auth-message"></p>
</div>

<!-- Home -->
<div id="home-screen" class="hidden">
  <h1>Mes Sets</h1>
  <button onclick="showSetEditor()">‚ûï Nouveau set</button>
  <div id="sets-list"></div>
  <button onclick="logout()">D√©connexion</button>
</div>

<!-- Editor -->
<div id="editor-screen" class="hidden">
  <h2>Cr√©er / Modifier un Set</h2>
  <input type="text" id="set-title" placeholder="Titre du set"><br>
  <input type="text" id="set-subject" placeholder="Mati√®re"><br>
  <input type="text" id="set-image" placeholder="URL image"><br>
  <div id="cards-editor"></div>
  <button onclick="addCardEditor()">‚ûï Ajouter une carte</button><br>
  <button onclick="saveSet()">üíæ Sauvegarder</button>
  <button onclick="goHome()">üè† Accueil</button>
</div>

<!-- Game -->
<div id="game-screen" class="hidden">
  <h2 id="game-title"></h2>
  <div class="card-container">
    <div class="card" onclick="flipCard()">
      <div class="card-face card-front" id="card-front"></div>
      <div class="card-face card-back" id="card-back"></div>
    </div>
  </div>
  <button onclick="markAnswer(false)">Mauvais</button>
  <button onclick="markAnswer(true)">Bon</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabaseUrl = "https://xiivahdidcwvqobbfocs.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhpaXZhaGRpZGN3dnFvYmJmb2NzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NDY1MjUsImV4cCI6MjA3MjIyMjUyNX0.-mbGjr5xo6ruJdTp8kfQqe3KksU5LaOP48upSz6sc3I";
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

let user = null, sets = [], currentSet = null, currentCards = [], currentIndex=0, errors=[];

// -------- Auth --------
async function login() {
  const email=document.getElementById("email").value;
  const password=document.getElementById("password").value;
  const { data, error } = await supabase.auth.signInWithPassword({email,password});
  if(error){ document.getElementById("auth-message").textContent=error.message; return; }
  user=data.user; showHome();
}

async function signup() {
  const email=document.getElementById("email").value;
  const password=document.getElementById("password").value;
  const { data, error } = await supabase.auth.signUp({email,password});
  if(error){ document.getElementById("auth-message").textContent=error.message; return; }
  document.getElementById("auth-message").textContent="Inscription r√©ussie ! Connecte-toi.";
}

function logout(){
  supabase.auth.signOut(); user=null;
  document.getElementById("auth-screen").classList.remove("hidden");
  document.getElementById("home-screen").classList.add("hidden");
}

// -------- Home / Sets --------
async function loadSets(){
  if(!user) return;
  const { data,error }=await supabase.from("sets").select("*").eq("user_id",user.id);
  if(error){ console.log(error); return; }
  sets=data;
  const list=document.getElementById("sets-list"); list.innerHTML="";
  sets.forEach((s,i)=>{
    const div=document.createElement("div");
    div.innerHTML=`<strong>${s.title}</strong> (${s.subject}) 
      <button onclick="deleteSet(${i})">üóëÔ∏è</button> 
      <button onclick="startGame(${i})">‚ñ∂Ô∏è Jouer</button> 
      <button onclick="showSetEditor(${i})">‚úèÔ∏è √âditer</button>`;
    list.appendChild(div);
  });
}

function showHome(){ document.getElementById("auth-screen").classList.add("hidden"); document.getElementById("editor-screen").classList.add("hidden"); document.getElementById("game-screen").classList.add("hidden"); document.getElementById("home-screen").classList.remove("hidden"); loadSets(); }
function goHome(){ showHome(); }

// -------- Editor --------
function showSetEditor(setIndex=null){
  document.getElementById("auth-screen").classList.add("hidden"); document.getElementById("home-screen").classList.add("hidden"); document.getElementById("game-screen").classList.add("hidden"); document.getElementById("editor-screen").classList.remove("hidden"); document.getElementById("cards-editor").innerHTML="";
  if(setIndex!==null){ currentSet=sets[setIndex]; document.getElementById("set-title").value=currentSet.title; document.getElementById("set-subject").value=currentSet.subject; document.getElementById("set-image").value=currentSet.image; currentSet.cards.forEach(c=>addCardEditor(c.question,c.answer)); } else currentSet=null;
}

function addCardEditor(q='',a=''){
  const div=document.createElement("div"); div.className="card-editor";
  div.innerHTML=`<input placeholder="Question" value="${q}"><br><input placeholder="R√©ponse" value="${a}"><br><button onclick="this.parentNode.remove()">Supprimer</button>`;
  document.getElementById("cards-editor").appendChild(div);
}

async function saveSet(){
  const title=document.getElementById("set-title").value;
  const subject=document.getElementById("set-subject").value;
  const image=document.getElementById("set-image").value;
  const cards=[];
  document.querySelectorAll("#cards-editor > .card-editor").forEach(div=>cards.push({question:div.children[0].value,answer:div.children[1].value}));
  if(currentSet){ await supabase.from("sets").update({title,subject,image,cards}).eq("id",currentSet.id); } 
  else { await supabase.from("sets").insert([{title,subject,image,cards,user_id:user.id}]); }
  currentSet=null; showHome();
}

async function deleteSet(i){
  if(confirm("Supprimer ce set ?")){
    await supabase.from("sets").delete().eq("id",sets[i].id);
    loadSets();
  }
}

// -------- Game --------
function startGame(i){
  currentSet=sets[i]; currentCards=[...currentSet.cards]; currentIndex=0; errors=[];
  document.getElementById("home-screen").classList.add("hidden"); document.getElementById("editor-screen").classList.add("hidden"); document.getElementById("game-screen").classList.remove("hidden");
  document.getElementById("game-title").textContent=currentSet.title;
  showCard();
}

function showCard(){
  if(currentIndex>=currentCards.length){ endGame(); return; }
  const card=currentCards[currentIndex];
  document.getElementById("card-front").textContent=card.question;
  document.getElementById("card-back").textContent=card.answer;
  document.querySelector(".card").classList.remove("flipped");
}

function flipCard(){ document.querySelector(".card").classList.toggle("flipped"); }

function markAnswer(correct){ if(!correct) errors.push(currentCards[currentIndex]); currentIndex++; showCard(); }

function endGame(){ alert(`Score: ${currentCards.length-errors.length}/${currentCards.length}`); showHome(); }

</script>
</body>
</html>
