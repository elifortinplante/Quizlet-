<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quizlet Supabase</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body { font-family: Arial, sans-serif; background: #f5f5f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
.container { width: 90%; max-width: 600px; background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
h1, h2 { text-align: center; color: #333; }
.hidden { display: none; }
.set { display: flex; align-items: center; justify-content: space-between; background: #eee; padding: 10px; border-radius: 10px; margin: 10px 0; cursor: pointer; }
.card-container { perspective: 1000px; margin: 20px 0; }
.card { width: 100%; height: 200px; position: relative; transform-style: preserve-3d; transition: transform 0.6s; cursor: pointer; }
.card.flipped { transform: rotateY(180deg); }
.card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 15px; display: flex; justify-content: center; align-items: center; font-size: 18px; font-weight: bold; text-align: center; padding: 10px; box-sizing: border-box; }
.card-front { background: #fff; }
.card-back { background: #f0f0f0; transform: rotateY(180deg); }
.answer-buttons { display: flex; justify-content: space-between; margin-top: 15px; }
.answer-buttons button { flex: 1; margin: 0 5px; padding: 10px; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; }
.correct { background: #a0e7a0; }
.incorrect { background: #f28b82; }
input { width: 95%; margin: 5px 0; padding: 8px; font-size: 16px; }
button { padding: 10px; margin-top: 10px; cursor: pointer; border-radius: 10px; border: none; }
</style>
</head>
<body>
<div class="container">
  <!-- Auth screens -->
  <div id="auth-screen">
    <h2>Connexion / Inscription</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Mot de passe">
    <button onclick="signUp()">S'inscrire</button>
    <button onclick="signIn()">Se connecter</button>
  </div>

  <!-- Home screen -->
  <div id="home-screen" class="hidden">
    <h1>Mes Sets</h1>
    <button onclick="showSetEditor()">‚ûï Nouveau set</button>
    <button onclick="signOut()">üö™ D√©connexion</button>
    <div id="sets-list"></div>
  </div>

  <!-- Set editor -->
  <div id="editor-screen" class="hidden">
    <h2>Cr√©er / Modifier un Set</h2>
    <input type="text" id="set-title" placeholder="Titre du set">
    <input type="text" id="set-subject" placeholder="Mati√®re">
    <input type="text" id="set-image" placeholder="URL image pour le set">
    <div id="cards-editor"></div>
    <button onclick="addCardEditor()">‚ûï Ajouter une carte</button>
    <button onclick="saveSet()">üíæ Sauvegarder</button>
    <button onclick="goHome()">üè† Accueil</button>
  </div>

  <!-- Game screen -->
  <div id="game-screen" class="hidden">
    <h2 id="game-title"></h2>
    <div class="card-container">
      <div class="card" onclick="flipCard()">
        <div class="card-face card-front">
          <div id="card-question"></div>
        </div>
        <div class="card-face card-back">
          <div id="card-answer"></div>
        </div>
      </div>
    </div>
    <div class="answer-buttons">
      <button class="incorrect" onclick="markAnswer(false)">Mauvais</button>
      <button class="correct" onclick="markAnswer(true)">Bon</button>
    </div>
  </div>
</div>

<script>
// --- Supabase setup ---
const supabaseUrl = 'https://xiivahdidcwvqobbfocs.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im53a3lyeXJzZm92Z2FhaGRya2VrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NTY1MDMsImV4cCI6MjA3MjIzMjUwM30.JW7neIhQIP9JrVeOPWJ5QoHqDVWTwSnwEAcTvJp5SZw';
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

// --- Auth functions ---
async function signUp() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  const { error } = await supabase.auth.signUp({ email, password });
  if(error) alert(error.message);
  else alert("Email envoy√© pour v√©rification !");
}

async function signIn() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  const { error } = await supabase.auth.signInWithPassword({ email, password });
  if(error) alert(error.message);
  else loadSets();
}

async function signOut() {
  await supabase.auth.signOut();
  document.getElementById('auth-screen').classList.remove('hidden');
  document.getElementById('home-screen').classList.add('hidden');
}

// --- Load sets ---
async function loadSets() {
  const { data: userData } = await supabase.auth.getUser();
  if(!userData.user) return;

  document.getElementById('auth-screen').classList.add('hidden');
  document.getElementById('home-screen').classList.remove('hidden');

  const { data, error } = await supabase.from('sets').select('*').eq('user_id', userData.user.id);
  if(error) alert(error.message);
  displaySets(data || []);
}

// --- Display sets ---
function displaySets(sets) {
  const list = document.getElementById('sets-list');
  list.innerHTML = '';
  sets.forEach((s) => {
    const div = document.createElement('div');
    div.className = 'set';
    div.textContent = `${s.title} (${s.subject})`;
    div.onclick = () => startGame(s);
    list.appendChild(div);
  });
}

// --- Editor ---
function showSetEditor() {
  document.getElementById('home-screen').classList.add('hidden');
  document.getElementById('editor-screen').classList.remove('hidden');
  document.getElementById('cards-editor').innerHTML = '';
}

function addCardEditor(q='', a='') {
  const div = document.createElement('div');
  div.innerHTML = `
    <input placeholder="Question" value="${q}">
    <input placeholder="R√©ponse" value="${a}">
    <button onclick="this.parentElement.remove()">üóëÔ∏è Supprimer</button><hr>
  `;
  document.getElementById('cards-editor').appendChild(div);
}

async function saveSet() {
  const title = document.getElementById('set-title').value;
  const subject = document.getElementById('set-subject').value;
  const image = document.getElementById('set-image').value;
  const cards = Array.from(document.querySelectorAll('#cards-editor > div')).map(div => {
    return { question: div.children[0].value, answer: div.children[1].value };
  });

  const { data: userData } = await supabase.auth.getUser();
  if(!userData.user) return alert("Erreur : utilisateur non connect√©");

  const { error } = await supabase.from('sets').insert([{ title, subject, image, cards, user_id: userData.user.id }]);
  if(error) alert(error.message);
  else goHome();
}

function goHome() {
  document.getElementById('editor-screen').classList.add('hidden');
  loadSets();
}

// --- Game ---
let currentCards = [];
let currentIndex = 0;

function startGame(set) {
  currentCards = [...set.cards];
  currentIndex = 0;
  document.getElementById('home-screen').classList.add('hidden');
  document.getElementById('game-screen').classList.remove('hidden');
  document.getElementById('game-title').textContent = set.title;
  showCard();
}

function showCard() {
  const card = currentCards[currentIndex];
  document.getElementById('card-question').textContent = card.question;
  document.getElementById('card-answer').textContent = card.answer;
  document.querySelector(".card").classList.remove("flipped");
}

function flipCard() { document.querySelector(".card").classList.toggle("flipped"); }

function markAnswer(correct) {
  currentIndex++;
  if(currentIndex < currentCards.length) showCard();
  else alert("Fin du set !");
}

// --- Check if already logged in ---
supabase.auth.getUser().then(({ data }) => {
  if(data.user) loadSets();
});
</script>
</body>
</html>
