<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quizlet Multi-Compte</title>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<style>
body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; display:flex; justify-content:center; align-items:center; min-height:100vh; }
.container { width:90%; max-width:600px; background:white; border-radius:15px; padding:20px; box-shadow:0 5px 15px rgba(0,0,0,0.2);}
h1,h2{text-align:center;color:#333;}
.hidden{display:none;}
.set{display:flex;align-items:center;justify-content:space-between;background:#eee;padding:10px;border-radius:10px;margin:10px 0;cursor:pointer;}
.card-container{perspective:1000px;margin:20px 0;}
.card{width:100%;height:200px;position:relative;transform-style:preserve-3d;transition:transform 0.6s;cursor:pointer;}
.card.flipped{transform:rotateY(180deg);}
.card-face{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:15px;display:flex;justify-content:center;align-items:center;font-size:18px;font-weight:bold;text-align:center;padding:10px;box-sizing:border-box;}
.card-front{background:#fff;}
.card-back{background:#f0f0f0;transform:rotateY(180deg);}
.answer-buttons{display:flex;justify-content:space-between;margin-top:15px;}
.answer-buttons button{flex:1;margin:0 5px;padding:10px;border:none;border-radius:10px;font-size:16px;cursor:pointer;}
.correct{background:#a0e7a0;}
.incorrect{background:#f28b82;}
input{width:95%;margin:5px 0;padding:8px;font-size:16px;}
button{padding:10px;margin-top:10px;cursor:pointer;border-radius:10px;border:none;}
</style>
</head>
<body>
<div class="container">
<!-- Auth screens -->
<div id="auth-screen">
<h2>Connexion / Inscription</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Mot de passe">
<button onclick="signUp()">S'inscrire</button>
<button onclick="signIn()">Se connecter</button>
</div>

<!-- Home screen -->
<div id="home-screen" class="hidden">
<h1>Mes Sets</h1>
<button onclick="showSetEditor()">‚ûï Nouveau set</button>
<button onclick="signOut()">üö™ D√©connexion</button>
<div id="sets-list"></div>
</div>

<!-- Set editor -->
<div id="editor-screen" class="hidden">
<h2>Cr√©er / Modifier un Set</h2>
<input type="text" id="set-title" placeholder="Titre du set">
<input type="text" id="set-subject" placeholder="Mati√®re">
<div id="cards-editor"></div>
<button onclick="addCardEditor()">‚ûï Ajouter une carte</button>
<button onclick="saveSet()">üíæ Sauvegarder</button>
<button onclick="goHome()">üè† Accueil</button>
</div>

<!-- Game screen -->
<div id="game-screen" class="hidden">
<h2 id="game-title"></h2>
<div class="card-container">
<div class="card" onclick="flipCard()">
<div class="card-face card-front"><div id="card-question"></div></div>
<div class="card-face card-back"><div id="card-answer"></div></div>
</div>
</div>
<div class="answer-buttons">
<button class="incorrect" onclick="markAnswer(false)">Mauvais</button>
<button class="correct" onclick="markAnswer(true)">Bon</button>
</div>
</div>
</div>

<script>
// --- Firebase config ---
const firebaseConfig = {
  apiKey: "AIzaSyB66qfMVZJxnFN0h8d3NHjCgTzrrJpZu28",
  authDomain: "quizlet-7eec7.firebaseapp.com",
  projectId: "quizlet-7eec7",
  storageBucket: "quizlet-7eec7.appspot.com",
  messagingSenderId: "650458729476",
  appId: "1:650458729476:web:82876ae94a85ca0d2cb951"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// --- Auth ---
function signUp(){
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  auth.createUserWithEmailAndPassword(email,password)
    .then(() => loadSets())
    .catch(e => alert(e.message));
}
function signIn(){
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  auth.signInWithEmailAndPassword(email,password)
    .then(() => loadSets())
    .catch(e => alert(e.message));
}
function signOut(){
  auth.signOut();
  document.getElementById('auth-screen').classList.remove('hidden');
  document.getElementById('home-screen').classList.add('hidden');
}

// --- Sets ---
let currentSet = null;
function loadSets(){
  const user = auth.currentUser;
  if(!user) return;
  document.getElementById('auth-screen').classList.add('hidden');
  document.getElementById('home-screen').classList.remove('hidden');
  db.collection('sets').where('uid','==',user.uid).get()
    .then(snap => displaySets(snap.docs.map(d => ({id:d.id,...d.data()}))));
}
function displaySets(sets){
  const list = document.getElementById('sets-list');
  list.innerHTML='';
  sets.forEach(s=>{
    const div=document.createElement('div');
    div.className='set';
    div.textContent=`${s.title} (${s.subject})`;
    div.onclick=()=>startGame(s);
    list.appendChild(div);
  });
}

// --- Editor ---
function showSetEditor(){
  document.getElementById('home-screen').classList.add('hidden');
  document.getElementById('editor-screen').classList.remove('hidden');
  document.getElementById('cards-editor').innerHTML='';
  currentSet=null;
}
function addCardEditor(q='',a=''){
  const div=document.createElement('div');
  div.innerHTML=`<input placeholder="Question" value="${q}"><input placeholder="R√©ponse" value="${a}"><button onclick="this.parentElement.remove()">üóëÔ∏è Supprimer</button><hr>`;
  document.getElementById('cards-editor').appendChild(div);
}
function saveSet(){
  const title=document.getElementById('set-title').value;
  const subject=document.getElementById('set-subject').value;
  const cards=Array.from(document.querySelectorAll('#cards-editor>div')).map(d=>({question:d.children[0].value,answer:d.children[1].value}));
  const user=auth.currentUser;
  if(!user) return alert("Non connect√© !");
  const data={uid:user.uid,title,subject,cards};
  if(currentSet){
    db.collection('sets').doc(currentSet.id).set(data)
      .then(()=>goHome());
  }else{
    db.collection('sets').add(data)
      .then(()=>goHome());
  }
}
function goHome(){
  document.getElementById('editor-screen').classList.add('hidden');
  loadSets();
}

// --- Game ---
let currentCards=[],currentIndex=0;
function startGame(set){
  currentSet=set;
  currentCards=[...set.cards];
  currentIndex=0;
  document.getElementById('home-screen').classList.add('hidden');
  document.getElementById('game-screen').classList.remove('hidden');
  document.getElementById('game-title').textContent=set.title;
  showCard();
}
function showCard(){
  const card=currentCards[currentIndex];
  document.getElementById('card-question').textContent=card.question;
  document.getElementById('card-answer').textContent=card.answer;
  document.querySelector(".card").classList.remove("flipped");
}
function flipCard(){document.querySelector(".card").classList.toggle("flipped");}
function markAnswer(correct){
  currentIndex++;
  if(currentIndex<currentCards.length) showCard();
  else{alert("Fin du set"); goHome();}
}

// --- Auto-load ---
auth.onAuthStateChanged(user=>{
  if(user) loadSets();
  else document.getElementById('auth-screen').classList.remove('hidden');
});
</script>
</body>
</html>
