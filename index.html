<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quizlet Multi-utilisateur</title>
<style>
body { margin:0; font-family: Arial,sans-serif; background:#f5f5f5; display:flex; justify-content:center; align-items:center; min-height:100vh;}
.container { width:90%; max-width:700px; background:white; border-radius:15px; padding:20px; box-shadow:0 5px 15px rgba(0,0,0,0.2);}
h1,h2 { text-align:center; }
.hidden { display:none; }
.set { display:flex; align-items:center; justify-content:space-between; background:#eee; padding:10px; border-radius:10px; margin:10px 0; cursor:pointer;}
.card-container { perspective:1000px; margin:20px 0;}
.card { width:100%; height:200px; position:relative; transform-style:preserve-3d; transition: transform 0.6s; cursor:pointer;}
.card.flipped { transform: rotateY(180deg);}
.card-face { position:absolute; width:100%; height:100%; backface-visibility:hidden; border-radius:15px; display:flex; justify-content:center; align-items:center; text-align:center; font-weight:bold; padding:10px; box-sizing:border-box;}
.card-front { background:#fff;}
.card-back { background:#f0f0f0; transform:rotateY(180deg);}
.answer-buttons { display:flex; justify-content:space-between; margin-top:15px;}
.answer-buttons button { flex:1; margin:0 5px; padding:10px; border:none; border-radius:10px; cursor:pointer;}
.correct { background:#a0e7a0;}
.incorrect { background:#f28b82;}
input { width:95%; margin:5px 0; padding:8px; font-size:16px;}
button { padding:10px; margin-top:10px; cursor:pointer; border-radius:10px; border:none;}
</style>
<script type="module">
// Firebase SDK
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, deleteDoc, query, where } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

// Config Firebase avec tes cl√©s
const firebaseConfig = {
  apiKey: "AIzaSyB66qfMVZJxnFN0h8d3NHjCgTzrrJpZu28",
  authDomain: "quizlet-7eec7.firebaseapp.com",
  projectId: "quizlet-7eec7",
  storageBucket: "quizlet-7eec7.appspot.com",
  messagingSenderId: "650458729476",
  appId: "1:650458729476:web:82876ae94a85ca0d2cb951"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// --- Screens ---
const authScreen = document.getElementById('auth-screen');
const homeScreen = document.getElementById('home-screen');
const editorScreen = document.getElementById('editor-screen');
const gameScreen = document.getElementById('game-screen');
const setsList = document.getElementById('sets-list');
let currentSet = null;
let currentCards = [];
let currentIndex = 0;
let errors = [];

// --- Auth functions ---
async function signUp() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  try {
    await createUserWithEmailAndPassword(auth, email, password);
    alert("Inscription r√©ussie !");
  } catch(e) { alert(e.message); }
}

async function signIn() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  try {
    await signInWithEmailAndPassword(auth, email, password);
  } catch(e) { alert(e.message); }
}

async function logout() {
  await signOut(auth);
  authScreen.classList.remove('hidden');
  homeScreen.classList.add('hidden');
}

// --- Load sets ---
async function loadSets() {
  setsList.innerHTML = '';
  const q = query(collection(db, "sets"), where("uid", "==", auth.currentUser.uid));
  const snapshot = await getDocs(q);
  snapshot.forEach(docSnap => {
    const s = docSnap.data();
    s.id = docSnap.id;
    const div = document.createElement('div');
    div.className = 'set';
    div.textContent = s.title + " (" + s.subject + ")";
    div.onclick = () => startGame(s);
    setsList.appendChild(div);
  });
}

// --- Editor ---
function showSetEditor(set=null) {
  homeScreen.classList.add('hidden');
  editorScreen.classList.remove('hidden');
  document.getElementById('cards-editor').innerHTML = '';
  currentSet = set;
  if(set && set.cards) set.cards.forEach(c => addCardEditor(c.question, c.answer));
}

function addCardEditor(q='', a='') {
  const div = document.createElement('div');
  div.innerHTML = `<input placeholder="Question" value="${q}"><input placeholder="R√©ponse" value="${a}"><button onclick="this.parentElement.remove()">Supprimer</button><hr>`;
  document.getElementById('cards-editor').appendChild(div);
}

async function saveSet() {
  const title = document.getElementById('set-title').value;
  const subject = document.getElementById('set-subject').value;
  const cards = Array.from(document.querySelectorAll('#cards-editor > div')).map(d => ({question:d.children[0].value, answer:d.children[1].value}));
  if(currentSet) {
    const setRef = doc(db, "sets", currentSet.id);
    await updateDoc(setRef, {title, subject, cards});
  } else {
    await addDoc(collection(db,"sets"), {title, subject, cards, uid:auth.currentUser.uid});
  }
  editorScreen.classList.add('hidden');
  homeScreen.classList.remove('hidden');
  loadSets();
}

// --- Game ---
function startGame(set) {
  currentSet = set;
  currentCards = [...set.cards];
  currentIndex = 0;
  errors = [];
  homeScreen.classList.add('hidden');
  gameScreen.classList.remove('hidden');
  showCard();
}

function showCard() {
  const card = currentCards[currentIndex];
  document.getElementById('card-question').textContent = card.question;
  document.getElementById('card-answer').textContent = card.answer;
  document.querySelector(".card").classList.remove("flipped");
}

function flipCard() { document.querySelector(".card").classList.toggle("flipped"); }

function markAnswer(correct) {
  if(!correct) errors.push(currentCards[currentIndex]);
  currentIndex++;
  if(currentIndex < currentCards.length) showCard();
  else alert("Fin du set !");
}

// --- Monitor auth ---
onAuthStateChanged(auth, user => {
  if(user) { authScreen.classList.add('hidden'); homeScreen.classList.remove('hidden'); loadSets(); }
  else { authScreen.classList.remove('hidden'); homeScreen.classList.add('hidden'); }
});
</script>
</head>
<body>
<div class="container">
  <div id="auth-screen">
    <h2>Connexion / Inscription</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Mot de passe">
    <button onclick="signUp()">S'inscrire</button>
    <button onclick="signIn()">Se connecter</button>
  </div>

  <div id="home-screen" class="hidden">
    <h1>Mes Sets</h1>
    <button onclick="showSetEditor()">‚ûï Nouveau set</button>
    <button onclick="logout()">D√©connexion</button>
    <div id="sets-list"></div>
  </div>

  <div id="editor-screen" class="hidden">
    <h2>Cr√©er / Modifier un Set</h2>
    <input type="text" id="set-title" placeholder="Titre du set"><br>
    <input type="text" id="set-subject" placeholder="Mati√®re"><br>
    <div id="cards-editor"></div>
    <button onclick="addCardEditor()">‚ûï Ajouter une carte</button>
    <button onclick="saveSet()">üíæ Sauvegarder</button>
    <button onclick="homeScreen.classList.remove('hidden');editorScreen.classList.add('hidden');">üè† Accueil</button>
  </div>

  <div id="game-screen" class="hidden">
    <h2 id="game-title"></h2>
    <div class="card-container">
      <div class="card" onclick="flipCard()">
        <div class="card-face card-front">
          <div id="card-question"></div>
        </div>
        <div class="card-face card-back">
          <div id="card-answer"></div>
        </div>
      </div>
    </div>
    <div class="answer-buttons">
      <button class="incorrect" onclick="markAnswer(false)">Mauvais</button>
      <button class="correct" onclick="markAnswer(true)">Bon</button>
    </div>
  </div>
</div>
</body>
</html>
